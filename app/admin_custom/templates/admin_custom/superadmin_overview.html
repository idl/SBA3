{% extends "admin_custom/admin_custom_base.html" %}
{% load bootstrap3 %}

{% block admin_main_content %}
  <div class="row">
    <div class="col-xs-12">
      <h2 class="text-center">Superadmin Panel</h2>
      <h4 class="text-center"><span class="text-muted">{{admin_email}}</span></h4>
    </div>
  </div>
  <hr>
  {% bootstrap_messages %}
  <div class="row">
    <div class="col-xs-12 col-sm-3">
      <h2 class="h4 no-margin-top">Create a New Administrator</h2>
      <div class="side-form-wrapper">
        <form action="{% url 'superadmin_create_admin' %}" method="post" class="form" role="form">
          {% csrf_token %}
          {% bootstrap_form superadmin_add_admin_form %}
          {% buttons %}
            <button type="submit" class="btn btn-primary btn-block">
              CREATE ADMINISTRATOR
            </button>
          {% endbuttons %}
        </form>
      </div>
      <h2 class="h4 no-margin-top">Create a New School</h2>
      <div class="side-form-wrapper">
        <form action="{% url 'superadmin_create_school' %}" method="post" class="form" role="form">
          {% csrf_token %}
          {% bootstrap_form superadmin_create_school_form %}
          {% buttons %}
            <button type="submit" class="btn btn-primary btn-block">
              CREATE SCHOOL
            </button>
          {% endbuttons %}
        </form>
      </div>
    </div>
    <div class="col-xs-12 col-sm-9">
        <h3 class="h4 text-bold pull-left"><strong>Please select a school for which view data:&emsp;</strong></h3>
        <form action="{% url 'superadmin_overview' %}" method="post" class="form-inline" role="form">
          {% csrf_token %}
          {% bootstrap_form superadmin_select_school_form %}
          {% buttons %}
            <button type="submit" class="btn btn-success btn-block">
              VIEW DATA
            </button>
          {% endbuttons %}
        </form>
      <hr>
      <h2 class="h3 no-margin-top">Administrators</h2>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <td><b>Email</b></td>
            <td><b>School</b></td>
            <td><b>Is Superuser?</b></td>
            <td><b>Date Joined</b></td>
            <td><b>Last Login</b></td>
            <td style="min-width:75px;"><b>Actions</b></td>
          </tr>
        </thead>
        <tbody>
          {% for admin in admins_list %}
            <tr>
              <td>{{admin.email}}</td>
              <td>
                {% if admin.school %}
                  {{admin.school}}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>{{admin.is_superuser}}</td>
              <td>{{admin.date_joined}}</td>
              <td>{{admin.last_login}}</td>
              <td style="min-width:75px;">
                <span data-placement="top" title="Edit Admin Info" data-toggle="tooltip">
                  <button class="btn btn-primary btn-xs edit-admin-modal-btn"
                    data-toggle="modal" data-target="#edit-admin-modal">
                    {% bootstrap_icon 'pencil' %}
                  </button>
                </span>
                <a href="{% url 'superadmin_delete_admin' admin.id %}"
                   class="btn btn-danger btn-xs" data-toggle="tooltip"
                   data-placement="top" title="Delete Admin">
                    {% bootstrap_icon 'remove' %}
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <hr>
      <h2 class="h3 no-margin-top">Schools</h2>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <td><b>School</b></td>
            <td><b>Location</b></td>
            <td><b>Survey Title</b></td>
            <td><b>Date Added</b></td>
            <td style="min-width:100px;"><b>Actions</b></td>
          </tr>
        </thead>
        <tbody>
          {% for school in schools_list %}
            <tr>
              <td>{{school.name}}</td>
              <td>{{school.location}}</td>
              <td>
                {% if school.survey_title %}
                  {{school.survey_title}}
                {% else %}
                  <em>Not Set</em>
                {% endif %}</td>
              <td>{{school.date_created}}</td>
              <td style="min-width:100px;">
                <a href="{% url 'admin_school_overview' school.id %}"
                   class="btn btn-default btn-xs" data-toggle="tooltip"
                   data-placement="top" title="View School Results">
                    {% bootstrap_icon 'eye-open' %}
                </a>
                <span data-placement="top" title="Edit School Info" data-toggle="tooltip">
                  <button class="btn btn-primary btn-xs edit-school-modal-btn"
                    data-toggle="modal" data-target="#edit-school-modal">
                    {% bootstrap_icon 'pencil' %}
                  </button>
                </span>
                <a href="{# url 'superadmin_delete_school' school_id #}"
                   class="btn btn-danger btn-xs" data-toggle="tooltip"
                   data-placement="top" title="Delete School">
                    {% bootstrap_icon 'remove' %}
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5">There aren't any schools. Please add one by using the form to the left.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}


{% block admin_main_content_js %}
<script>
  $(document).ready(function() {
    $select = $('#id_admin_school');
    $('[data-toggle="tooltip"]').tooltip();
    $('#id_is_superuser').click(function(e) {
      if($(e.currentTarget).is(':checked')) {
        $select.attr('disabled', 'disabled');
        $select.prop('required', false);
        $('#id_admin_school').closest('.form-group').animate({
          'opacity': 0.25
        }, 300);
      } else {
        $select.prop('disabled', false);
        $select.prop('required', true);
        $('#id_admin_school').closest('.form-group').animate({
          'opacity': 1
        }, 300);
      }
    });
    $('.edit-admin-modal-btn').click(function(e) {
      $row = $(e.currentTarget).closest('tr');
      email = $row.find('td')[0].innerHTML;
      $('.modal-title-admin-name').text();
    });
  });
</script>
{% endblock %}

{% block admin_modals_content %}
  <div class="modal fade" id="edit-admin-modal" tabindex="-1" role="dialog"
    aria-labelledby="Edit Administrator Information" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <form action="superadmin_overview_submit" method="post">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Edit Admin: <span class="modal-title-admin-name"></span></h4>
          </div>
          <div class="modal-body">
            <p>One fine body&hellip;</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </form>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
{% endblock %}

{% block admin_modals_js %}
  <div class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Modal title</h4>
        </div>
        <div class="modal-body">
          <p>One fine body&hellip;</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
{% endblock %}